# Stock adjustments

Adjusts the stock of a [Product](#products) at a specific [Location](#locations).

For bulk products, stock can be added (positive quantity) or removed (negative quantity).

For trackable products, [StockItems](#stock-items) are created.
To remove [StockItems](#stock-items), use the [StockItemArchivation](#stock-item-archivations) resource.

**Removing stock can cause shortage.** The request will fail,
and the `error.code` attribute will have the value `shortage`.
When the shortage is within the shortage limit of the product,
a warning is returned. Otherwise a blocking error is returned.
A warning can be overriden by setting `confirm_shortage` to `true`.
The orders that would be affected by the shortage can be found in
either `meta.blocking[0].order_ids` or `meta.warning[0].order_ids`.

## Relationships
Name | Description
-- | --
`location` | **[Location](#locations)** `required`<br>The [Location](#locations) where stock is adjusted. 
`product` | **[Product](#products)** `required`<br>The [Product](#products) whose stock needs to be adjusted. 
`stock_items` | **[Stock items](#stock-items)** `hasmany`<br>The [StockItems](#stock-items) that have been generated by adjusting stock. 


Check matching attributes under [Fields](#stock-adjustments-fields) to see which relations can be written.
<br/ >
Check each individual operation to see which relations can be included as a sideload.
## Fields

 Name | Description
-- | --
`confirm_shortage` | **boolean** `nullable`<br>A value of `true` overrides shortage warnings. Overriding shortage is only possible when the product allows shortage, and the resulting shortage is within the limit for the product. 
`from` | **datetime** `nullable`<br>The date from which the new stock will be available. When this date is in the future, the stock will be shown as "expected". When this date is `null`, the stock will be available immediately. 
`id` | **uuid** `readonly`<br>Primary key.
`location_id` | **uuid** <br>The [Location](#locations) where stock is adjusted. 
`prefix` | **string** `nullable`<br>The prefix to use to generate identifiers for [StockItems](#stock-items). When left empty, the SKU from the product will be used. When adding temporary stock, `TMP-` will be added automatically. 
`product_id` | **uuid** <br>The [Product](#products) whose stock needs to be adjusted. 
`quantity` | **integer** <br>How much stock to add or remove. For trackable [Products](#products) this means the number of [StockItems](#stock-items) that will be created. Removing stock by setting a negative quantity is only possible for bulk products. 
`till` | **datetime** `nullable`<br>The date till which the stock will be available. When this date is set, the stock will be considered "temporary". 


## Add stock (bulk)


> Add stock to a bulk product:

```shell
  curl --request POST
       --url 'https://example.booqable.com/api/4/stock_adjustments'
       --header 'content-type: application/json'
       --data '{
         "data": {
           "type": "stock_adjustments",
           "attributes": {
             "product_id": "70fad66c-5710-4baa-8b5c-37c053fff200",
             "location_id": "6badcd2f-233c-4360-87fd-d83ee972a0ab",
             "quantity": 10,
             "from": "2027-09-21T19:27:03.000000+00:00",
             "till": null
           }
         }
       }'
```

> A 200 status response looks like this:

```json
  {
    "data": {
      "id": "aac71372-3b85-4060-833e-c84b236fc670",
      "type": "stock_adjustments",
      "attributes": {
        "quantity": 10,
        "from": "2027-09-21T19:27:03.000000+00:00",
        "till": null,
        "prefix": null,
        "confirm_shortage": null,
        "product_id": "70fad66c-5710-4baa-8b5c-37c053fff200",
        "location_id": "6badcd2f-233c-4360-87fd-d83ee972a0ab"
      },
      "relationships": {}
    },
    "meta": {}
  }
```

### HTTP Request

`POST /api/4/stock_adjustments`

### Request params

This request accepts the following parameters:

Name | Description
-- | --
`fields[]` | **array** <br>List of comma separated fields to include instead of the default fields. `?fields[stock_adjustments]=quantity,from,till`
`include` | **string** <br>List of comma seperated relationships to sideload. `?include=product,stock_items`


### Request body

This request accepts the following body:

Name | Description
-- | --
`data[attributes][confirm_shortage]` | **boolean** <br>A value of `true` overrides shortage warnings. Overriding shortage is only possible when the product allows shortage, and the resulting shortage is within the limit for the product. 
`data[attributes][from]` | **datetime** <br>The date from which the new stock will be available. When this date is in the future, the stock will be shown as "expected". When this date is `null`, the stock will be available immediately. 
`data[attributes][location_id]` | **uuid** <br>The [Location](#locations) where stock is adjusted. 
`data[attributes][prefix]` | **string** <br>The prefix to use to generate identifiers for [StockItems](#stock-items). When left empty, the SKU from the product will be used. When adding temporary stock, `TMP-` will be added automatically. 
`data[attributes][product_id]` | **uuid** <br>The [Product](#products) whose stock needs to be adjusted. 
`data[attributes][quantity]` | **integer** <br>How much stock to add or remove. For trackable [Products](#products) this means the number of [StockItems](#stock-items) that will be created. Removing stock by setting a negative quantity is only possible for bulk products. 
`data[attributes][till]` | **datetime** <br>The date till which the stock will be available. When this date is set, the stock will be considered "temporary". 


### Includes

This request accepts the following includes:

<ul>
  <li><code>product</code></li>
  <li><code>stock_items</code></li>
</ul>


## Add stock (trackable)


> Add stock items to a trackable product:

```shell
  curl --request POST
       --url 'https://example.booqable.com/api/4/stock_adjustments'
       --header 'content-type: application/json'
       --data '{
         "data": {
           "type": "stock_adjustments",
           "attributes": {
             "product_id": "43137334-e017-444b-8a72-de5aae265a4c",
             "location_id": "264e9817-aaea-42f0-83ac-07dc2d679915",
             "quantity": 2,
             "prefix": "XYZ"
           }
         },
         "include": "stock_items"
       }'
```

> A 200 status response looks like this:

```json
  {
    "data": {
      "id": "dfe5dfa8-65a9-4115-888f-4bffae11171d",
      "type": "stock_adjustments",
      "attributes": {
        "quantity": 2,
        "from": null,
        "till": null,
        "prefix": "XYZ",
        "confirm_shortage": null,
        "product_id": "43137334-e017-444b-8a72-de5aae265a4c",
        "location_id": "264e9817-aaea-42f0-83ac-07dc2d679915"
      },
      "relationships": {
        "stock_items": {
          "data": [
            {
              "type": "stock_items",
              "id": "e409d5fd-b40f-4f3e-8c02-35862b0a1514"
            },
            {
              "type": "stock_items",
              "id": "05afa8b9-28ef-4f99-802e-5ac8c3184127"
            }
          ]
        }
      }
    },
    "included": [
      {
        "id": "e409d5fd-b40f-4f3e-8c02-35862b0a1514",
        "type": "stock_items",
        "attributes": {
          "created_at": "2021-11-06T07:42:00.000000+00:00",
          "updated_at": "2021-11-06T07:42:00.000000+00:00",
          "archived": false,
          "archived_at": null,
          "identifier": "XYZ-1",
          "status": "in_stock",
          "from": null,
          "till": null,
          "stock_item_type": "regular",
          "product_group_id": "323c63ff-5037-42ee-896b-aef7717f2eac",
          "properties": {},
          "product_id": "43137334-e017-444b-8a72-de5aae265a4c",
          "location_id": "264e9817-aaea-42f0-83ac-07dc2d679915"
        },
        "relationships": {}
      },
      {
        "id": "05afa8b9-28ef-4f99-802e-5ac8c3184127",
        "type": "stock_items",
        "attributes": {
          "created_at": "2021-11-06T07:42:00.000000+00:00",
          "updated_at": "2021-11-06T07:42:00.000000+00:00",
          "archived": false,
          "archived_at": null,
          "identifier": "XYZ-2",
          "status": "in_stock",
          "from": null,
          "till": null,
          "stock_item_type": "regular",
          "product_group_id": "323c63ff-5037-42ee-896b-aef7717f2eac",
          "properties": {},
          "product_id": "43137334-e017-444b-8a72-de5aae265a4c",
          "location_id": "264e9817-aaea-42f0-83ac-07dc2d679915"
        },
        "relationships": {}
      }
    ],
    "meta": {}
  }
```

### HTTP Request

`POST /api/4/stock_adjustments`

### Request params

This request accepts the following parameters:

Name | Description
-- | --
`fields[]` | **array** <br>List of comma separated fields to include instead of the default fields. `?fields[stock_adjustments]=quantity,from,till`
`include` | **string** <br>List of comma seperated relationships to sideload. `?include=product,stock_items`


### Request body

This request accepts the following body:

Name | Description
-- | --
`data[attributes][confirm_shortage]` | **boolean** <br>A value of `true` overrides shortage warnings. Overriding shortage is only possible when the product allows shortage, and the resulting shortage is within the limit for the product. 
`data[attributes][from]` | **datetime** <br>The date from which the new stock will be available. When this date is in the future, the stock will be shown as "expected". When this date is `null`, the stock will be available immediately. 
`data[attributes][location_id]` | **uuid** <br>The [Location](#locations) where stock is adjusted. 
`data[attributes][prefix]` | **string** <br>The prefix to use to generate identifiers for [StockItems](#stock-items). When left empty, the SKU from the product will be used. When adding temporary stock, `TMP-` will be added automatically. 
`data[attributes][product_id]` | **uuid** <br>The [Product](#products) whose stock needs to be adjusted. 
`data[attributes][quantity]` | **integer** <br>How much stock to add or remove. For trackable [Products](#products) this means the number of [StockItems](#stock-items) that will be created. Removing stock by setting a negative quantity is only possible for bulk products. 
`data[attributes][till]` | **datetime** <br>The date till which the stock will be available. When this date is set, the stock will be considered "temporary". 


### Includes

This request accepts the following includes:

<ul>
  <li><code>product</code></li>
  <li><code>stock_items</code></li>
</ul>


## Remove stock (bulk)


> Remove stock from bulk product:

```shell
  curl --request POST
       --url 'https://example.booqable.com/api/4/stock_adjustments'
       --header 'content-type: application/json'
       --data '{
         "data": {
           "type": "stock_adjustments",
           "attributes": {
             "product_id": "54f3efb8-a875-4087-8e5f-a9d7119ec553",
             "location_id": "1c9abb03-c9a9-4275-8a23-5e93b7d94e4c",
             "quantity": -5
           }
         }
       }'
```

> A 200 status response looks like this:

```json
  {
    "data": {
      "id": "12134910-6f7b-4685-893e-00b89172cf2e",
      "type": "stock_adjustments",
      "attributes": {
        "quantity": -5,
        "from": null,
        "till": null,
        "prefix": null,
        "confirm_shortage": null,
        "product_id": "54f3efb8-a875-4087-8e5f-a9d7119ec553",
        "location_id": "1c9abb03-c9a9-4275-8a23-5e93b7d94e4c"
      },
      "relationships": {}
    },
    "meta": {}
  }
```

> Remove stock from bulk product, causing shortage:

```shell
  curl --request POST
       --url 'https://example.booqable.com/api/4/stock_adjustments'
       --header 'content-type: application/json'
       --data '{
         "data": {
           "type": "stock_adjustments",
           "attributes": {
             "product_id": "5046c7b4-f597-4e3b-8cc2-fbdb26e612e3",
             "location_id": "fba46066-c280-4b90-8c5b-665a49e893c7",
             "quantity": -5
           }
         }
       }'
```

> A 422 status response looks like this:

```json
  {
    "errors": [
      {
        "code": "shortage",
        "status": "422",
        "title": "Shortage",
        "detail": "This will create shortage for running or future orders",
        "meta": {
          "warning": [],
          "blocking": [
            {
              "reason": "shortage",
              "shortage": 4,
              "item_id": "5046c7b4-f597-4e3b-8cc2-fbdb26e612e3",
              "mutation": -5,
              "orders": [
                {
                  "id": "27eb795b-c0c7-466c-8c90-40d5c6025995",
                  "conflicts": 4
                }
              ],
              "downtimes": [],
              "location_id": "fba46066-c280-4b90-8c5b-665a49e893c7",
              "available": 1,
              "plannable": 1,
              "stock_count": 5,
              "planned": 4,
              "needed": 4,
              "cluster_available": 1,
              "cluster_plannable": 1,
              "cluster_stock_count": 5,
              "cluster_planned": 4,
              "cluster_needed": 4
            }
          ]
        }
      }
    ]
  }
```

### HTTP Request

`POST /api/4/stock_adjustments`

### Request params

This request accepts the following parameters:

Name | Description
-- | --
`fields[]` | **array** <br>List of comma separated fields to include instead of the default fields. `?fields[stock_adjustments]=quantity,from,till`
`include` | **string** <br>List of comma seperated relationships to sideload. `?include=product,stock_items`


### Request body

This request accepts the following body:

Name | Description
-- | --
`data[attributes][confirm_shortage]` | **boolean** <br>A value of `true` overrides shortage warnings. Overriding shortage is only possible when the product allows shortage, and the resulting shortage is within the limit for the product. 
`data[attributes][from]` | **datetime** <br>The date from which the new stock will be available. When this date is in the future, the stock will be shown as "expected". When this date is `null`, the stock will be available immediately. 
`data[attributes][location_id]` | **uuid** <br>The [Location](#locations) where stock is adjusted. 
`data[attributes][prefix]` | **string** <br>The prefix to use to generate identifiers for [StockItems](#stock-items). When left empty, the SKU from the product will be used. When adding temporary stock, `TMP-` will be added automatically. 
`data[attributes][product_id]` | **uuid** <br>The [Product](#products) whose stock needs to be adjusted. 
`data[attributes][quantity]` | **integer** <br>How much stock to add or remove. For trackable [Products](#products) this means the number of [StockItems](#stock-items) that will be created. Removing stock by setting a negative quantity is only possible for bulk products. 
`data[attributes][till]` | **datetime** <br>The date till which the stock will be available. When this date is set, the stock will be considered "temporary". 


### Includes

This request accepts the following includes:

<ul>
  <li><code>product</code></li>
  <li><code>stock_items</code></li>
</ul>

